<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title th:text="${editMode} ? 'Editar Servicio | Proveedor' : 'Nuevo Servicio | Proveedor'">Nuevo Servicio | Proveedor</title>
	<link rel="stylesheet" href="/css/provider-styles.css" />
	<link rel="stylesheet" href="/css/admin-styles.css" />
</head>
<body class="provider-body">
	<div class="provider-topbar">
		<div class="pt-left">
			<a href="/" class="pt-logo" title="Inicio"><img src="/imgs/Waira.svg" alt="Waira" /></a>
		</div>
		<div class="pt-center"></div>
		<div class="pt-right"><a href="/dashboard" class="pt-link">Volver al dashboard</a></div>
	</div>

	<main class="crear-servicio-main">
		<section class="crear-servicio-section">
			<header class="crear-servicio-header">
				<p class="hero-pill" th:text="${editMode} ? 'Editar servicio' : 'Nuevo servicio'">Nuevo servicio</p>
				<h1 th:text="${editMode} ? 'Actualiza la información de tu experiencia' : 'Presenta tu experiencia como proveedor'">Presenta tu experiencia como proveedor</h1>
				<p th:text="${editMode} ? 'Ajusta datos, categorías e imágenes cuando necesites mantener tu oferta al día.' : 'Comparte detalles, imágenes y precio para que el equipo de Waira publique tu servicio.'">Comparte detalles, imágenes y precio para que el equipo de Waira publique tu servicio.</p>
			</header>

			<div th:if="${error}" class="form-error" th:text="${error}"></div>

			<form th:action="${editMode} ? @{/proveedor/servicios/{id}/actualizar(id=${servicioId})} : @{/proveedor/servicios}"
				  th:object="${crearServicioDTO}"
				  method="post"
				  class="crear-servicio-form"
				  enctype="multipart/form-data"
				  th:attr="data-requires-images=${!editMode}">
				<div class="form-grid">
					<div class="form-group">
						<label for="nombreServicio">Nombre del servicio</label>
						<input type="text" id="nombreServicio" th:field="*{nombreServicio}" maxlength="120" required placeholder="Ej. Avistamiento de aves en la sierra" />
					</div>
					<div class="form-group">
						<label for="diasDuracion">Duración (días)</label>
						<input type="number" id="diasDuracion" th:field="*{diasDuracion}" min="1" max="365" required />
					</div>
				</div>

				<div class="form-group">
					<label for="descripcion">Descripción</label>
					<textarea id="descripcion" th:field="*{descripcion}" rows="6" maxlength="1500" placeholder="Cuenta en qué consiste, qué incluye, recomendaciones y requisitos." required></textarea>
				</div>

				<div class="form-group form-group--full">
					<label>Categorías y subcategorías</label>
					<p class="input-help" data-categoria-help>Selecciona al menos una categoría para describir tu servicio.</p>
					<div class="categoria-tree" data-categoria-tree>
						<div class="categoria-node" th:each="categoria : ${categoriasDisponibles}">
							<label class="categoria-header">
								<input type="checkbox" th:value="${categoria.idCategoria}" th:field="*{categoriasIds}" data-categoria-checkbox />
								<span class="categoria-nombre" th:text="${categoria.nombreCategoria}"></span>
								<span class="categoria-count" th:text="${categoria.subcategorias != null ? #lists.size(categoria.subcategorias) : 0} + ' subcategorías'"></span>
							</label>
							<div class="subcategoria-list" th:if="${categoria.subcategorias != null && !categoria.subcategorias.isEmpty()}">
								<label th:each="sub : ${categoria.subcategorias}">
									<input type="checkbox"
										th:value="${sub.idSubcategoria}"
										th:field="*{subcategoriasIds}"
										th:attr="data-parent-id=${categoria.idCategoria}"
										data-subcategoria-checkbox />
									<span th:text="${sub.nombreSubcategoria}"></span>
								</label>
							</div>
						</div>
						<div class="categoria-empty" th:if="${#lists.isEmpty(categoriasDisponibles)}">
							<p>No hay categorías configuradas todavía.</p>
						</div>
					</div>
				</div>

				<div class="form-grid">
					<div class="form-group">
						<label for="precioDisplay">Precio referencia (COP)</label>
						<input type="hidden" id="precio" th:field="*{precio}" />
						<input type="text" id="precioDisplay" placeholder="$0" inputmode="numeric" autocomplete="off" required />
					</div>
					<div class="form-group">
						<label for="tipoVia">Tipo de vía</label>
						<input type="text" id="tipoVia" th:field="*{tipoVia}" placeholder="Carrera, Calle, Avenida" required />
					</div>
					<div class="form-group">
						<label for="numero">Número</label>
						<input type="text" id="numero" th:field="*{numero}" placeholder="Ej. 5 # 12-34" required />
					</div>
					<div class="form-group">
						<label for="complemento">Complemento</label>
						<input type="text" id="complemento" th:field="*{complemento}" placeholder="Apartamento, referencia opcional" />
					</div>
					<div class="form-group">
						<label for="barrio">Barrio / Sector</label>
						<input type="text" id="barrio" th:field="*{barrio}" required />
					</div>
					<div class="form-group">
						<label for="ciudad">Ciudad</label>
						<input type="text" id="ciudad" th:field="*{ciudad}" required />
					</div>
				</div>

				<div class="form-group">
					<label for="imagenes">Fotografías del servicio</label>
					<input type="file" id="imagenes" name="imagenes" accept="image/jpeg,image/png" multiple class="file-input-hidden" th:attr="required=${!editMode}" />
					<button type="button" class="btn btn-orange file-upload-trigger" data-file-trigger>Cargar imágenes</button>
					<p class="input-help" data-imagenes-help th:text="${editMode} ? 'Puedes reemplazar tus imágenes subiendo una nueva selección (2 a 10 archivos, máx. 5 MB c/u).' : 'Selecciona entre 2 y 10 imágenes JPG o PNG (máx. 5 MB cada una).'}">Selecciona entre 2 y 10 imágenes JPG o PNG (máx. 5 MB cada una).</p>
				</div>

				<div class="form-actions">
					<button type="submit" class="btn btn-primary" th:text="${editMode} ? 'Guardar cambios' : 'Publicar servicio'">Publicar servicio</button>
					<button type="button" class="btn btn-orange" data-cancel-btn>Cancelar</button>
				</div>
			</form>
		</section>
	</main>

	<div class="modal" id="confirmModal" aria-hidden="true">
		<div class="modal-dialog" role="dialog" aria-modal="true">
			<header class="modal-header">
				<h2 th:text="${editMode} ? 'Confirmar actualización' : 'Confirmar publicación'">Confirmar publicación</h2>
			</header>
			<div class="modal-body">
				<p th:text="${editMode} ? 'Guardaremos los cambios y actualizaremos la publicación al instante. ¿Deseas continuar?' : 'Revisaremos la información antes de publicar tu servicio en Waira. ¿Deseas continuar?'}">Revisaremos la información antes de publicar tu servicio en Waira. ¿Deseas continuar?</p>
			</div>
			<div class="modal-actions">
				<button type="button" class="btn btn-orange" id="modalCancel">Volver</button>
				<button type="button" class="btn btn-primary" id="modalConfirm">Confirmar</button>
			</div>
		</div>
	</div>

	<script src="/js/provider-servicio-form.js"></script>
</body>
</html>
